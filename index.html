<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>sync.</title>
    <link rel="stylesheet" href="ui/styles.css" />
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script type="text/javascript" src="lib/CSInterface.js"></script>
  </head>
  <body>
    <div class="app-container">
      
      <!-- Header -->
      <div class="app-header">
        <div class="header-section header-left">
          <a href="https://sync.so" class="logo">
            <img src="icons/white_icon.png" alt="sync." width="32" height="32" />
          </a>
        </div>

        <div class="header-section header-center">
          <div class="tab-switcher">
            <button class="tab-switch active" data-tab="sources">
              <i data-lucide="film"></i>
              <span>sources</span>
            </button>
            <button class="tab-switch" data-tab="history">
              <i data-lucide="history"></i>
              <span>history</span>
            </button>
          </div>
        </div>

        <div class="header-section header-right">
          <div class="profile-menu">
            <button class="profile-btn">
              <img src="icons/avatar.png" alt="Profile" class="avatar" width="32" height="32" />
        </button>
            <div class="profile-dropdown">
              <div class="dropdown-content">
                <div class="dropdown-item-wrapper">
              <div class="dropdown-item" data-tab="settings">
                    <i data-lucide="settings" style="color: #ff7700;"></i>
                <span>extension settings</span>
          </div>
                </div>
                <a href="https://sync.so/billing/subscription" class="dropdown-item" target="_blank" rel="noopener noreferrer">
                  <i data-lucide="credit-card" style="color: #ff7700;"></i>
                <span>billing</span>
              </a>
                <a href="https://sync.so/settings/api-keys" class="dropdown-item" target="_blank" rel="noopener noreferrer">
                  <i data-lucide="key" style="color: #ff7700;"></i>
                <span>api keys</span>
              </a>
                <a href="https://docs.sync.so/" class="dropdown-item" target="_blank" rel="noopener noreferrer">
                  <i data-lucide="help-circle" style="color: #ff7700;"></i>
                <span>docs and support</span>
              </a>
              <div class="dropdown-version">
                  <p>
                    v.0.4.0 Â·
                    <span class="update-link">check for updates</span>
                  </p>
                </div>
      </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Wrapper -->
      <div class="content-wrapper">
        
        <!-- Sources Tab -->
        <div id="sources" class="tab-pane active">
          <div class="sources-container">
            
            <!-- Video Upload -->
            <div class="upload-box video-upload" id="videoSection">
              <div id="videoDropzone" class="upload-content">
                <div class="upload-visual">
                  <div class="icon-group">
                    <div class="icon-float rotate-15" style="top: 15.62px; left: 124.62px;">
                      <i data-lucide="file-video" style="width: 39px; height: 39px; color: #525258;"></i>
                    </div>
                    <div class="icon-float rotate-neg-15" style="top: 24.41px; left: 69.4px;">
                      <i data-lucide="clapperboard" style="width: 32px; height: 32px; color: #3b3b40;"></i>
                    </div>
                    <div class="icon-bg"></div>
                    <i data-lucide="file-video-2" class="icon-main" style="width: 48px; height: 48px; color: #d4d4d4;"></i>
                  </div>
                  <p class="upload-text">choose a video to edit</p>
                </div>
                <div class="upload-actions">
                  <div class="action-row">
                    <button class="action-btn" data-action="video-upload">
                      <i data-lucide="upload"></i>
                      <span>upload</span>
                    </button>
                    <button class="action-btn" data-action="video-inout">
                      <i data-lucide="square-dashed-mouse-pointer"></i>
                      <span>use in/out</span>
                    </button>
                  </div>
                  <div class="action-row">
                    <button class="action-btn" data-action="video-record">
                      <i data-lucide="webcam"></i>
                      <span>record</span>
                    </button>
                    <button class="action-btn" data-action="video-link">
                      <i data-lucide="link"></i>
                      <span>link url</span>
                    </button>
                  </div>
                </div>
              </div>
              <div id="videoPreview" style="display: none;"></div>
            </div>
        
            <!-- Audio Upload -->
            <div class="upload-box audio-upload" id="audioSection">
              <div id="audioDropzone" class="upload-content">
                <div class="upload-visual">
                  <div class="icon-group icon-group-audio">
                    <div class="icon-float rotate-15" style="top: 15.62px; left: 124.62px;">
                      <i data-lucide="audio-lines" style="width: 39px; height: 39px; color: #525258;"></i>
                    </div>
                    <div class="icon-float rotate-neg-15" style="top: 24.41px; left: 69.4px;">
                      <i data-lucide="mic" style="width: 32px; height: 32px; color: #3b3b40;"></i>
                    </div>
                    <div class="icon-bg icon-bg-audio"></div>
                    <i data-lucide="file-audio" class="icon-main" style="width: 48px; height: 48px; color: #d4d4d4;"></i>
                  </div>
                  <p class="upload-text">choose an audio to sync</p>
                </div>
                <div class="upload-actions">
                  <div class="action-row">
                    <button class="action-btn" data-action="audio-upload">
                      <i data-lucide="upload"></i>
                      <span>upload</span>
                    </button>
                    <button class="action-btn" data-action="audio-inout">
                      <i data-lucide="square-dashed-mouse-pointer"></i>
                      <span>use in/out</span>
                    </button>
                  </div>
                  <div class="action-row">
                    <button class="action-btn" data-action="audio-record">
                      <i data-lucide="mic"></i>
                      <span>record</span>
                    </button>
                    <button class="action-btn" data-action="audio-link">
                      <i data-lucide="link"></i>
                      <span>link url</span>
                    </button>
                  </div>
                  <div class="action-row">
                    <button class="action-btn" data-action="audio-from-video">
                      <i data-lucide="video"></i>
                      <span>from video</span>
                    </button>
                    <button class="action-btn" data-action="audio-generate">
                      <i data-lucide="sparkles"></i>
                      <span>generate</span>
                    </button>
                  </div>
                </div>
              </div>
              <div id="audioPreview" style="display: none;"></div>
              <div class="custom-dropdown-menu" id="ttsMenu" style="display: none;">
                <div class="custom-dropdown-option" data-value="placeholder">
                  <i data-lucide="type"></i>
                  <span>text-to-speech (coming soon)</span>
                </div>
              </div>
              <div class="custom-dropdown-menu" id="dubbingMenu" style="display: none;">
                <div class="custom-dropdown-option" data-value="placeholder">
                  <i data-lucide="audio-lines"></i>
                  <span>dubbing (coming soon)</span>
                </div>
              </div>
            </div>
            
            <!-- Status and hidden inputs for existing logic -->
            <p id="statusMessage"></p>
            <input type="hidden" id="renderVideo" value="h264" />
            <input type="hidden" id="renderAudio" value="wav" />
            <input type="hidden" id="temperature" value="0.5" />
            <input type="hidden" id="activeSpeakerOnly" />
            <input type="hidden" id="detectObstructions" />
          </div>
        </div>
        
        <!-- History Tab -->
        <div id="history" class="tab-pane">
          <div class="history-wrapper">
            <div id="historyList" class="history-list-container">
              <!-- History items will be rendered here by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-pane">
          <div class="settings-container">
            <div class="settings-header">
              <div class="settings-tabs-nav">
                <button class="settings-tab-btn active" data-settings-tab="global">
                  <span>global settings</span>
                  <div class="tab-underline"></div>
                </button>
                <button class="settings-tab-btn" data-settings-tab="render">
                  <span>render settings</span>
                  <div class="tab-underline"></div>
                </button>
              </div>
            </div>
            
            <!-- Global Settings -->
            <div id="global" class="settings-tab-pane active">
              <div class="settings-section api-keys-section">
                <h3 class="settings-section-title">api keys</h3>
                <div class="api-keys-wrapper">
                  <div class="api-key-row">
                    <input type="password" id="syncApiKey" class="api-key-input" placeholder="sync. api key" data-key-prefix="sk-" />
                    <div class="api-key-buttons">
                      <i data-lucide="check" class="api-key-checkmark" id="syncApiKeyCheck"></i>
                      <button class="api-key-btn copy-btn" title="Copy" data-target="syncApiKey">
                        <i data-lucide="copy"></i>
                  </button>
                      <button class="api-key-btn info-btn" title="Info" data-url="https://docs.sync.so/quickstart#create-your-api-key">
                        <i data-lucide="info"></i>
                  </button>
                </div>
                  </div>
                  <div class="api-key-row">
                    <input type="password" id="elevenlabsApiKey" class="api-key-input" placeholder="elevenlabs api key" data-key-prefix="sk_" />
                    <div class="api-key-buttons">
                      <i data-lucide="check" class="api-key-checkmark" id="elevenlabsApiKeyCheck"></i>
                      <button class="api-key-btn copy-btn" title="Copy" data-target="elevenlabsApiKey">
                        <i data-lucide="copy"></i>
                  </button>
                      <button class="api-key-btn info-btn" title="Info" data-url="https://elevenlabs.io/app/settings/api-keys">
                        <i data-lucide="info"></i>
                  </button>
                    </div>
                  </div>
                </div>
        </div>
        
              <div class="settings-section save-files-section">
                <h3 class="settings-section-title">save files</h3>
                <div class="save-files-grid">
                  <button class="save-option active" data-save-location="project">
                    <i data-lucide="list-video" style="width: 45px; height: 45px;"></i>
                    <span>per project folder (sync. outputs)</span>
                  </button>
                  <button class="save-option" data-save-location="universal">
                    <i data-lucide="folder-open-dot" style="width: 45px; height: 45px;"></i>
                    <span>universal folder in ~/documents</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Render Settings -->
            <div id="render" class="settings-tab-pane">
              <!-- Video Settings -->
              <div class="settings-section render-video-section">
                <h3 class="settings-section-title">video settings</h3>
                <div class="render-grid">
                  <button class="render-option video-option active" data-video-format="mp4">
                    <span class="render-format-name">mp4</span>
                    <span class="render-format-desc">h.264</span>
                  </button>
                  <div class="render-option video-option prores-container" data-video-format="prores">
                    <div class="prores-header">
                      <span class="render-format-name">prores</span>
                    </div>
                    <div class="prores-options">
                      <button class="prores-option" data-prores-type="422">422</button>
                      <button class="prores-option" data-prores-type="422hq">422 hq</button>
                      <button class="prores-option" data-prores-type="422proxy">422 proxy</button>
                      <button class="prores-option" data-prores-type="422lt">422 lt</button>
                </div>
              </div>
                </div>
                <p class="render-hint">need other codecs? <a href="mailto:hello@sync.so" target="_blank" rel="noopener noreferrer">let us know.</a></p>
              </div>

              <!-- Audio Settings -->
              <div class="settings-section render-audio-section">
                <h3 class="settings-section-title">audio settings</h3>
                <div class="render-grid">
                  <button class="render-option audio-option" data-audio-format="mp3">
                    <span class="render-format-name">mp3</span>
                    <span class="render-format-desc">320kbps</span>
                  </button>
                  <button class="render-option audio-option active" data-audio-format="wav">
                    <span class="render-format-name">wav</span>
                    <span class="render-format-desc">32bit</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        </div>
        
      <!-- Bottom Bar -->
      <div class="bottom-bar">
        <div class="bottom-content">
          <button class="model-btn" id="modelSelectorBtn">
            <span id="currentModel">lipsync-2</span>
            <i data-lucide="chevron-down"></i>
            <div class="update-dot"></div>
          </button>
          <button class="lipsync-btn" id="lipsyncBtn" disabled>
            <img src="icons/white_icon.png" alt="sync." width="16" height="16" />
            <span>lipsync</span>
          </button>
        </div>
        <p class="cost-display" id="costDisplay">
          <span class="cost-label">est. cost:</span> $0.00
        </p>
        </div>
        
        </div>
    
      <!-- Model Selector Overlay -->
      <div class="model-selector-overlay" id="modelSelectorOverlay">
        <div class="model-selector-panel">
          <div class="model-panel-handle"></div>
          
          <div class="model-selector-header">
            <h3>choose model</h3>
            <button class="model-selector-close" id="modelSelectorClose">
              <i data-lucide="x"></i>
            </button>
          </div>
          
          <div class="model-options">
            <label class="model-option">
              <input type="radio" name="model" value="lipsync-2-pro" />
              <div class="model-option-icon"></div>
              <div class="model-option-content">
                <div class="model-option-title">
                  <span class="model-name">lipsync-2-pro</span>
                  <span class="model-badge">new</span>
                </div>
                <span class="model-desc">lipsync-2 optimized for the highest resolution</span>
              </div>
            </label>
            
            <label class="model-option">
              <input type="radio" name="model" value="lipsync-2" />
              <div class="model-option-icon">
                <i data-lucide="check"></i>
              </div>
              <div class="model-option-content">
                <div class="model-option-title">
                  <span class="model-name">lipsync-2</span>
                </div>
                <span class="model-desc">our best model yet: high-rez, matches speaker style</span>
              </div>
            </label>
            
            <label class="model-option">
              <input type="radio" name="model" value="lipsync-1.9.0-beta" />
              <div class="model-option-icon"></div>
              <div class="model-option-content">
                <div class="model-option-title">
                  <span class="model-name">lipsync-1.9.0-beta</span>
                </div>
                <span class="model-desc">our fastest lipsync model yet</span>
              </div>
            </label>
          </div>
          
          <div class="model-divider"></div>
          
          <div class="model-section-title">preferences</div>
          
          <div class="model-settings">
            <div class="model-setting-row">
              <label class="model-setting-label">
                <span>temperature: <span id="modelTempValue">0.5</span></span>
                <div class="tooltip-wrapper">
                  <i data-lucide="circle-help" class="model-info-icon"></i>
                  <div class="tooltip">
                    <strong>temperature</strong><br>
                    controls generation randomness. higher temperature gets more creative results.
                  </div>
                </div>
              </label>
              <div class="model-slider-wrapper">
                <input type="range" id="modelTemperature" class="model-slider" min="0" max="1" step="0.1" value="0.5" />
              </div>
            </div>
            
            <div class="model-setting-row model-setting-switch model-setting-dropdown">
              <label class="model-setting-label">
                <span>sync mode</span>
                <div class="tooltip-wrapper">
                  <i data-lucide="circle-help" class="model-info-icon"></i>
                  <div class="tooltip">
                    <strong>sync mode</strong><br>
                    defines how to handle duration mismatches between video and audio inputs.
                  </div>
                </div>
              </label>
              <div class="custom-dropdown-wrapper">
                <button type="button" class="custom-dropdown-trigger" id="syncModeBtn">
                  <span id="syncModeValue">loop</span>
                  <i data-lucide="chevron-down"></i>
                </button>
                <div class="custom-dropdown-menu" id="syncModeMenu">
                  <div class="custom-dropdown-option" data-value="bounce">
                    <i data-lucide="circle-dot"></i>
                    <span>bounce</span>
                  </div>
                  <div class="custom-dropdown-option" data-value="loop">
                    <i data-lucide="repeat"></i>
                    <span>loop</span>
                  </div>
                  <div class="custom-dropdown-option" data-value="cutoff">
                    <i data-lucide="scissors"></i>
                    <span>cut off</span>
                  </div>
                  <div class="custom-dropdown-option" data-value="silence">
                    <i data-lucide="mic-off"></i>
                    <span>silence</span>
                  </div>
                  <div class="custom-dropdown-option" data-value="remap">
                    <i data-lucide="copy-check"></i>
                    <span>remap</span>
                  </div>
                </div>
                <input type="hidden" id="syncMode" value="loop" />
              </div>
            </div>
            
            <div class="model-setting-row model-setting-switch">
              <label class="model-setting-label">
                <span>lipsync only active speaker</span>
                <div class="tooltip-wrapper">
                  <i data-lucide="circle-help" class="model-info-icon"></i>
                  <div class="tooltip">
                    <strong>active speaker detection (asd)</strong><br>
                    when enabled, only detected active speaker will be lipsynced. it only works when source video has original audio.
                  </div>
                </div>
              </label>
              <label class="model-toggle">
                <input type="checkbox" id="modelActiveSpeaker" />
                <span class="model-toggle-slider"></span>
              </label>
            </div>
            
            <div class="model-setting-row model-setting-switch">
              <label class="model-setting-label">
                <span>detect obstructions</span>
                <div class="tooltip-wrapper">
                  <i data-lucide="circle-help" class="model-info-icon"></i>
                  <div class="tooltip">
                    <strong>obstructions</strong><br>
                    when enabled, automatically detects objects covering the lower face (e.g., hands, microphones) and blends original frames using precise masks for smoother, natural results without artifacts.
                  </div>
                </div>
              </label>
              <label class="model-toggle">
                <input type="checkbox" id="modelDetectObstructions" />
                <span class="model-toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    
        <script src="ui/loader.js"></script>
        <script src="ui/nle.js"></script>
        <script src="ui/core.js"></script>
        <script src="ui/media.js"></script>
        <script src="ui/dnd.js"></script>
        <script src="ui/host-detection.js"></script>
        <script src="ui/thumbnails.js"></script>
    <script src="ui/history.js"></script>
        <script src="ui/jobs.js"></script>
        <script src="ui/settings.js"></script>
        <script src="ui/cost.js"></script>
        <script src="ui/bootstrap.js"></script>
        
        <script>
          // Initialize Lucide icons
          lucide.createIcons();
        </script>
    
    <script>
      // Tab switching
      document.querySelectorAll('.tab-switch').forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.dataset.tab;
          
          // Use showTab function to handle tab switching properly
          if (typeof window.showTab === 'function') {
            window.showTab(tab);
          } else {
            // Fallback to manual switching
            document.querySelectorAll('.tab-switch').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
          }
        });
      });
      
      // Profile dropdown
      const profileBtn = document.querySelector('.profile-btn');
      const dropdown = document.querySelector('.profile-dropdown');
      
      profileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdown.classList.toggle('show');
      });
      
      // Dropdown items with tab attribute
      document.querySelectorAll('.dropdown-item[data-tab]').forEach(item => {
        item.addEventListener('click', () => {
          const tab = item.dataset.tab;
          
          // Clear all tabs
          document.querySelectorAll('.tab-switch').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
          
          // Show selected tab
          document.getElementById(tab).classList.add('active');
          
          // Close dropdown
          dropdown.classList.remove('show');
        });
      });
      
      document.addEventListener('click', () => {
        dropdown.classList.remove('show');
      });
      
      dropdown.addEventListener('click', (e) => {
        e.stopPropagation();
      });
      
      // Settings tab switching
      document.querySelectorAll('.settings-tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.dataset.settingsTab;
          
          // Update buttons
          document.querySelectorAll('.settings-tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          // Update panes
          document.querySelectorAll('.settings-tab-pane').forEach(p => p.classList.remove('active'));
          document.getElementById(tab).classList.add('active');
        });
      });
    </script>
  </body>
</html>
